<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¥–ª—è –°–æ–Ω—è—á–∫–∏!</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body { 
            margin: 0; padding: 0; 
            background-color: #ffe6f0;
            background-image: radial-gradient(#ffb3d1 18%, transparent 18%);
            background-size: 45px 45px; 
            overflow: hidden; 
            font-family: 'Press Start 2P', cursive; 
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        #music-toggle { position: absolute; top: 20px; left: 20px; padding: 10px; background: #ffb3d1; border: 3px solid #ff4d6d; font-size: 14px; cursor: pointer; z-index: 1000; line-height: 1; border-radius: 4px; }
        #secret-btn { position: absolute; top: 20px; right: 20px; padding: 10px; background: #ffb3d1; border: 3px solid #ff4d6d; font-size: 8px; color: #330000; cursor: pointer; z-index: 1000; border-radius: 4px; }

        .clickable-heart { position: absolute; font-size: 42px; cursor: pointer; z-index: 10; transition: opacity 0.5s ease; user-select: none; line-height: 1; }
        
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 230, 240, 0.95); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 2000; padding: 20px; box-sizing: border-box; }
        .note { background: white; padding: 25px; border: 4px solid #ff4d6d; max-width: 90%; font-size: 10px; line-height: 1.8; color: #330000; text-align: center; box-shadow: 5px 5px 0px #ffb3d1; }
        
        #secret-box { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffe6f0; display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 5000; padding: 20px; box-sizing: border-box; }
        #secret-box input { padding: 15px; font-family: 'Press Start 2P'; border: 3px solid #ff4d6d; text-align: center; margin-bottom: 20px; width: 80%; outline: none; font-size: 16px; background: white; border-radius: 0; -webkit-appearance: none; }
        
        .btn-group { display: flex; gap: 15px; justify-content: center; width: 100%; }
        .action-btn { padding: 12px 18px; font-family: 'Press Start 2P'; font-size: 8px; background: #ffb3d1; border: 3px solid #ff4d6d; cursor: pointer; color: #330000; border-radius: 4px; }

        #poem-area { width: 100%; height: 100%; display: none; flex-direction: column; align-items: center; justify-content: center; position: absolute; top: 0; left: 0; z-index: 6000; background: #ffe6f0; }
        .poem-text { font-size: 9px; line-height: 1.8; text-align: center; color: #330000; white-space: pre-wrap; width: 90%; max-height: 70vh; overflow-y: auto; margin-bottom: 20px; }
        
        #final-msg { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 4px solid #ff4d6d; padding: 30px 20px; text-align: center; display: none; z-index: 4000; font-size: 10px; width: 85%; line-height: 1.8; color: #330000; }
        .footer-credit { position: fixed; bottom: 15px; right: 15px; font-size: 8px; color: #ff4d6d; z-index: 5; font-weight: bold; }
        #error-msg { color: #ff4d6d; font-size: 8px; margin-bottom: 10px; display: none; }
        
        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞ */
        #start-hint { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,230,240,0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; text-align: center; font-size: 10px; color: #ff4d6d; cursor: pointer; }
    </style>
</head>
<body>

<div id="start-hint">–Ω–∞–∂–º–∏ –∫—É–¥–∞ —É–≥–æ–¥–Ω–æ,<br>—á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å... ‚ú®</div>

<div id="music-toggle">üîä</div>
<div id="secret-btn">–°–ï–ö–†–ï–¢</div>

<div id="overlay">
    <div id="big-heart-icon" style="font-size: 50px; margin-bottom: 15px;">üíñ</div>
    <div class="note" id="note-text"></div>
</div>

<div id="secret-box">
    <div id="code-area" style="text-align:center; width:100%;">
        <div id="error-msg">–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥!</div>
        <p style="font-size: 9px; margin-bottom: 15px;">–í–í–ï–î–ò –ö–û–î:</p>
        <input type="tel" id="code-input" placeholder="******" maxlength="6">
        <div class="btn-group">
            <button class="action-btn" onclick="checkCode()">–í–í–ï–°–¢–ò</button>
            <button class="action-btn" onclick="closeSecret()">–ù–ê–ó–ê–î</button>
        </div>
    </div>
    <div id="poem-area">
        <div class="poem-text" id="poem-content"></div>
        <button id="poem-back-btn" class="action-btn" style="display:none;" onclick="closeSecret()">–ù–ê–ó–ê–î</button>
    </div>
</div>

<div id="final-msg">–ö–æ–Ω–µ—Ü! –≤—Å–µ —Å–µ—Ä–¥–µ—á–∫–∏ –ø–æ–π–º–∞–Ω—ã...<br><br>–Ω–∞–¥–µ—é—Å—å –¢–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å.ü©∑</div>

<div class="footer-credit">special for –°–æ—Ñ–∏—è –ú—è—É–∫–æ–≤–Ω–∞</div>

<audio id="bg-music" loop preload="auto">
    <source src="https://www.chosic.com/wp-content/uploads/2021/04/Rainy-Day-Lofi-Chill-Melody.mp3" type="audio/mpeg">
</audio>

<script>
    let audioCtx;
    const bgMusic = document.getElementById('bg-music');
    const musicToggle = document.getElementById('music-toggle');
    const startHint = document.getElementById('start-hint');
    let isMusicPlaying = false;
    let audioUnlocked = false;

    // –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ò
    function startEverything() {
        if (audioUnlocked) return;
        
        // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º AudioContext –¥–ª—è iPhone/Samsung
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É
        bgMusic.play().then(() => {
            isMusicPlaying = true;
            musicToggle.innerText = "üîä";
        }).catch(e => console.log("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–ø–ª–µ—è:", e));

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        startHint.style.display = 'none';
        audioUnlocked = true;
    }

    // –°–ª—É—à–∞–µ–º –∫–ª–∏–∫ –ø–æ –≤—Å–µ–º—É —ç–∫—Ä–∞–Ω—É –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
    window.addEventListener('click', startEverything, { once: true });
    window.addEventListener('touchstart', startEverything, { once: true });

    function toggleMusic(e) {
        e.stopPropagation();
        if (!audioUnlocked) { startEverything(); return; }
        
        if (isMusicPlaying) {
            bgMusic.pause();
            musicToggle.innerText = "üîá";
        } else {
            bgMusic.play();
            musicToggle.innerText = "üîä";
        }
        isMusicPlaying = !isMusicPlaying;
    }
    musicToggle.onclick = toggleMusic;

    function playSynthSound(freq, type, duration, vol) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    let mainPhrases = [
        "–¢—ã - –ø—Ä–∏—á–∏–Ω–∞ –º–æ–µ–π —Å–∞–º–æ–π –∏—Å–∫—Ä–µ–Ω–Ω–µ–π —É–ª—ã–±–∫–∏", "–¢—ã –¥–µ–ª–∞–µ—à—å –º–æ—é –∂–∏–∑–Ω—å —è—Ä—á–µ",
        "–¢–≤–æ–π –≥–æ–ª–æ—Å - –ª—é–±–∏–º–∞—è –º—É–∑—ã–∫–∞", "—Å–∫—É—á–∞—é –ø–æ –¢–µ–±–µ –≤—Å–µ–≥–¥–∞",
        "–¢–≤–æ–∏ –≥–ª–∞–∑–∞ —Å–∞–º—ã–µ –∫—Ä–∞—Å–∏–≤—ã–µ", "–¢—ã - –ª—É—á—à–µ–µ, —á—Ç–æ –µ—Å—Ç—å",
        "—Å –¢–æ–±–æ–π —è —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Å–æ–±–æ–π", "–¢—ã –º–æ–π –º–∏–ª—ã–π –∫–æ—Ç–µ–Ω–æ–∫",
        "—Ö–æ—á—É —á—Ç–æ–±—ã –¢—ã –≤—Å–µ–≥–¥–∞ —É–ª—ã–±–∞–ª–∞—Å—å"
    ];

    const heartIcons = ['üíñ','üíó','üíì','ü©∑'];
    let caughtCount = 0;
    let isFinished = false;
    let codeFound = false;

    function createHeart(index, total) {
        const h = document.createElement('div');
        h.className = 'clickable-heart';
        h.innerText = heartIcons[index % heartIcons.length];
        let x = Math.random() * (window.innerWidth - 60);
        let y = Math.random() * (window.innerHeight - 60);
        let dx = (Math.random() - 0.5) * 3; 
        let dy = (Math.random() - 0.5) * 3;

        function move() {
            if (document.getElementById('overlay').style.display !== 'flex' && 
                document.getElementById('secret-box').style.display !== 'flex') {
                x += dx; y += dy;
                if (x <= 0 || x >= window.innerWidth - 60) dx *= -1;
                if (y <= 0 || y >= window.innerHeight - 60) dy *= -1;
                h.style.left = x + 'px';
                h.style.top = y + 'px';
            }
            requestAnimationFrame(move);
        }

        h.onclick = (e) => {
            e.stopPropagation();
            if (!audioUnlocked) startEverything();
            playSynthSound(880, 'sine', 0.2, 0.1);
            
            caughtCount++;
            let currentText = "";
            if (caughtCount >= 5 && !codeFound) {
                currentText = "–∫–æ–¥: 050909";
                codeFound = true;
            } else { currentText = mainPhrases.pop() || "–¢—ã —á—É–¥–æ!"; }

            document.getElementById('note-text').innerText = currentText;
            document.getElementById('overlay').style.display = 'flex';
            h.style.display = 'none';
            if(caughtCount === total) isFinished = true;
        };
        document.body.appendChild(h);
        move();
    }

    const totalHearts = mainPhrases.length + 1;
    for(let i=0; i < totalHearts; i++) createHeart(i, totalHearts);

    document.getElementById('overlay').onclick = () => {
        document.getElementById('overlay').style.display = 'none';
        if(isFinished) { 
            document.getElementById('final-msg').style.display = 'block'; 
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }
    };

    function checkCode() {
        if(document.getElementById('code-input').value === '050909') {
            document.getElementById('code-area').style.display = 'none';
            document.getElementById('poem-area').style.display = 'flex';
            document.getElementById('poem-content').innerText = "–¢—É—Ç –±—É–¥–µ—Ç –¢–≤–æ–π —Å—Ç–∏—Ö...";
            document.getElementById('poem-back-btn').style.display = 'inline-block';
        } else {
            document.getElementById('error-msg').style.display = 'block';
        }
    }

    function closeSecret() {
        document.getElementById('secret-box').style.display = 'none';
    }

    document.getElementById('secret-btn').onclick = (e) => {
        e.stopPropagation();
        if (!audioUnlocked) startEverything();
        document.getElementById('secret-box').style.display = 'flex';
    };
</script>
</body>
</html>
